"""
Script Name: unicode-decode.py
Author: Justin Lund
Date created: 08/17/23
Last modified: 08/17/23
Version: 1.0

Purpose:
Decodes unicode escape sequences

Coming soon:
Colourized output for programming language syntax when using -p / --print option

Usage examples:
python3 unicode-decode.py -i input.txt
python3 unicode-decode.py -i input.txt -o decoded_unicode.txt
python3 unicode-decode.py -i input.txt -o decoded_unicode.txt -p
"""

import re
import argparse

def replace_unicode_escape(match):
    return chr(int(match.group(1), 16))

def decode_unicode_escapes(input_file, output_file, print_output):
    # Read the file
    with open(input_file, 'r', encoding='utf-8') as file:
        content = file.read()

    # Use a regular expression to find and decode the escape sequences
    decoded_content = re.sub(r'\\u([0-9a-fA-F]{4})', replace_unicode_escape, content)

    if output_file:
        # Write the decoded content to the new file
        with open(output_file, 'w', encoding='utf-8') as file:
            file.write(decoded_content)

    if print_output:
        # Print the decoded content
        print(decoded_content)

    print("Decoding done!")

def main():
    parser = argparse.ArgumentParser(description="Decode Unicode escape sequences")
    parser.add_argument("-i", "--input", required=True, help="Input file with the encoded content")
    parser.add_argument("-o", "--output", default="output.txt", help="Output file to save the decoded content to (default: output.txt)")
    parser.add_argument("-p", "--print", action="store_true", help="Print the output on screen instead of writing to an output file, unless -o also specified")

    args = parser.parse_args()

    decode_unicode_escapes(args.input, args.output if not args.print or args.output != "output.txt" else None, args.print)

if __name__ == "__main__":
    main()
