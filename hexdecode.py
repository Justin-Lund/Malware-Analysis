"""
Script Name: hexdecode.py
Author: Justin Lund
Last modified: 04/16/24
Date created: 06/06/23
Version: 1.1.2

Purpose:
Decodes hex

Usage:
python3 hexdecode.py -i hex.txt -o output.txt
python3 hexdecode.py -i hex.txt -p

Roadmap:
- Add feature to decode hex in files with other content
    - Reference code frfom unicode-escape-decode.py for this
"""

import argparse
import binascii

# setup argument parser
parser = argparse.ArgumentParser()
parser.add_argument("-i", "--input", help="Input file containing hex string")
parser.add_argument("-o", "--output", help="Output file to write decoded string")
parser.add_argument("-p", "--print", action="store_true", help="Print the output to the screen")
args = parser.parse_args()

# open and read the input file
with open(args.input, 'r') as file:
    hex_string = file.read().replace('\n', '')

# remove unnecessary characters
hex_string = hex_string.replace(",", "").replace("\\", "").replace(" ", "")

# convert hex to bytes
bytes_object = bytes.fromhex(hex_string)

# decode bytes to ASCII
ascii_string = bytes_object.decode("ASCII", errors="ignore")

# print or write to file based on arguments
if args.output:
    with open(args.output, 'w') as file:
        file.write(ascii_string + '\n')  # Append a newline at the end of the file
        print(f"Decoded data has been written to {args.output}")
    if args.print:
        print(ascii_string)
elif args.print or not args.output:
    print(ascii_string)
